# MSX-MUSIC の FM-BIOS 向け演奏データの仕様

## ヘッダ

| 位置      | 意味                       | 備考                   |
| --------- | -------------------------- | ---------------------- |
| 0000-0001 | トラックの数 x 2           | 000e (6+1) か 0012 (9) |
| 0002-     | 各トラックのデータ先頭位置 |                        |

## ソングデータ

| 値            | 意味                                           |
| ------------- | ---------------------------------------------- |
| 00, n...      | 休符 / 2 バイト目以降が長さ                    |
| 01...5F, n... | 発音 / 1 バイト目が音階 / 2 バイト目以降が長さ |
| 60...6f       | 音量指定 / 60 が最大 / 6f が最小               |
| 70...7f       | 音色指定 / 0〜15 の音色番号用                  |
| 80            | サスティン ON                                  |
| 81            | サスティン OFF                                 |
| 82, n         | 音色指定 / 0〜63 の音色番号用                  |
| 83, nn        | ユーザー音色とそのアドレス                     |
| 84            | タイ・スラーを OFF にする                      |
| 85            | タイ・スラーを ON にする                       |
| 86, n         | 音長比                                         |
| ff            | トラックデータ末尾                             |

- 長さ指定はフレーム数で指定される
  - 秒間フレーム数は 1/60 か 1/50 になるはず（1/60 固定かもしれない）
  - フレーム数が 255 以上の場合、まず 255 を書き込み、次バイトに残りを書き込む
    - 残りが 255 以上であれば繰り返す
- タイ・スラー
  - 0x85 の後の発音からスラーが始まる
  - 0x84 の後の発音でスラーが終わる
  - `C&D` であれば `C` の前にフラグ ON `D` の前でフラグ OFF
- ユーザー音色のアドレスは絶対アドレス
  - 演奏データとは別に持つのがよさそう

## リズムデータ

- 0-4bit が各楽器の指定
  - 0: ハイハット
  - 1: シンバル
  - 2: タム
  - 3: スネアドラム
  - 4: バスドラム
- 5bit は常に 1
- 6bit は常に 0
- 7bit が 1 の場合は音量、0 の場合は発音
  - 音量の場合は次の値が音量（0 が最大、15 が最小）
  - 発音の場合は次の値以降が長さ（長さはソングデータと同じ可変長）
- 休符は全楽器 OFF での発音が該当する
